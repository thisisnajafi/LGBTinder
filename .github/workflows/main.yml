name: LGBTinder Flutter App - Change Notification

on:
  push:
    branches:
      - main

jobs:
  notify:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Notify Telegram
        env:
          TELEGRAM_BOT_TOKEN: 7488407974:AAFl4Ek9IanbvlkKlRoikQAqdkDtFYbD0Gc
          TELEGRAM_CHAT_ID: -1002401613512_32
          GITHUB_ACTOR: ${{ github.actor }}
          COMMIT_MESSAGE: ${{ github.event.head_commit.message }}
        run: |
          # Format commit message for Telegram
          FORMATTED_COMMIT_MESSAGE=$(echo "${COMMIT_MESSAGE}" | sed 's/"/\\"/g' | sed 's/$/\\n/' | sed ':a;N;$!ba;s/\n/\\n/g')
          
          # Create notification message
          MESSAGE="ğŸš€ <b>LGBTinder Flutter App</b> ğŸš€

          ğŸ“ <b>New Changes Pushed</b>

          ğŸ‘¤ <b>Updated by:</b> ${GITHUB_ACTOR}

          ğŸ’¬ <b>Commit Message:</b>
          <blockquote>${FORMATTED_COMMIT_MESSAGE}</blockquote>

          âœ… <b>Changes Ready for Review!</b>

          ğŸ“Š <b>Current Progress:</b> ~45% Complete
          ğŸ“‹ <b>Next Steps:</b> Backend integration & missing screens"

          # Send to Telegram
          curl -s -X POST https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendMessage \
            -d chat_id=${TELEGRAM_CHAT_ID} \
            -d text="${MESSAGE}" \
            -d parse_mode="HTML" \
            -d disable_web_page_preview=true